{% extends 'base/layout.html' %}
{% load static %}

{% block main %}
<main class="p-4 mx-auto max-w-screen-lg space-y-8">
  <section class="space-y-4 md:space-y-0 md:flex md:flex-row md:justify-between md:items-baseline">
    <div class="flex flex-row space-x-4 items-baseline">
      <h1 class="text-blue-500 text-xl font-semibold">Zeitplan {{ schedule.id }}</h1>
      <div class="text-sm">
        von
        <span class="px-2 rounded bg-slate-100">{{ schedule.owner.username }}</span>
      </div>
    </div>
    <div class="flex flex-row space-x-4 overflow-x-auto">
      <a class="font-semibold text-blue-500"
         href="{% url 'schedule_settings' schedule.id %}">Einstellungen</a>
      <a class="hover:text-blue-500"
         href="{% url 'schedule_preferences' schedule.id %}">Verfügbarkeiten</a>
      <a class="hover:text-blue-500"
         href="{% url 'schedule_assignments' schedule.id %}">Verteilung</a>
    </div>
  </section>
  <section class="space-y-4">
    <div>
      Lege hier die Tage des Zeitplans fest. Klicke auf einen freien
      Tag, um diesen zum Zeitplan hinzuzufügen. Klicke auf einen
      markierten Tag, um diesen vom Zeitplan zu entfernen.
    </div>
    <div id="calendar"></div>
  </section>
</main>
{% endblock %}

{% block scripts %}
<script src="{% static 'solver/js/api.js' %}"></script>
<script src="{% static 'solver/js/calendar.js' %}"></script>
<script>
  let api = new API(
      "{% url 'api:schedule_days' schedule.id %}",
      "{% url 'api:schedule_preferences' schedule.id %}",
      "{% url 'api:schedule_assignments' schedule.id %}",
      "{{ csrf_token }}",
  );
  let calendar = Calendar("#calendar", {
      initialDate: {% if schedule.start %}"{{ schedule.start.isoformat }}"{% else %}undefined{% endif %},
      eventSources: [{
          url: "{% url 'api:schedule_days' schedule.id %}",
          display: "background",
      }],
      eventClick: function(info){
          let dateStr = info.event.startStr;
          api.removeDay(dateStr).then(
              r => {if (r.ok){ this.refetchEvents() }}
          )
      },
      dateClick: function(info){
          let dateStr = info.dateStr;
          if (this.getEvents().filter(e => e.startStr == dateStr).length){
              return;
          }
          api.addDay(dateStr).then(
              r => {if (r.ok) { this.refetchEvents() }}
          )
      },
  });
  calendar.render();
</script>
{% endblock %}

